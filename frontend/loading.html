<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Loading - Postgres & Chill</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  :root{
    --bg:#0e0e0e;
    --panel:#141414;
    --text:#f5f5f5;
    --muted:#b9b9b9;
    --brand:#DFA601;
    --brand2:#f0c52b;
    --error:#ff4444;
  }

  body{
    margin:0;
    height:100vh;
    background:var(--bg);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    font-family:'Segoe UI', sans-serif;
    color:var(--text);
    overflow:hidden;
  }

  .logo{
    width:90px;
    margin-bottom:20px;
    animation:fadeIn 1.2s ease;
  }

  .spinner{
    width:70px;
    height:70px;
    border:6px solid #222;
    border-top:6px solid var(--brand);
    border-radius:50%;
    animation:spin 0.85s linear infinite;
    margin-bottom:22px;
  }

  @keyframes spin{ to{ transform:rotate(360deg); } }
  @keyframes fadeIn{
    from{ opacity:0; transform:translateY(10px); }
    to{ opacity:1; transform:translateY(0); }
  }

  h1{
    color:var(--brand);
    font-size:1.8rem;
    margin:5px 0 10px;
    animation:fadeIn 1.2s ease;
  }

  #status{
    color:var(--muted);
    font-size:1rem;
    margin-top:4px;
    animation:fadeIn 1.2s ease;
  }

  #errorBox{
    display:none;
    color:var(--error);
    margin-top:20px;
    font-size:1.1rem;
    font-weight:bold;
    text-align:center;
  }

  #retryBtn{
    margin-top:10px;
    padding:10px 20px;
    background:transparent;
    border:1px solid var(--brand);
    color:var(--brand);
    border-radius:6px;
    cursor:pointer;
    font-weight:600;
    display:none;
  }

  #retryBtn:hover{
    background:var(--brand);
    color:#141414;
  }
</style>
</head>

<body>

  <img src="logo.png" class="logo">
  <div class="spinner"></div>

  <h1>Starting Postgres & Chill...</h1>
  <p id="status">Initializing services...</p>

  <div id="errorBox">⚠ Backend startup failed. Please try again.</div>
  <button id="retryBtn" onclick="retry()">Retry</button>

<script>
let attempts = 0;
const maxAttempts = 600; // ~10 min max
const statusText = document.getElementById("status");
const errorBox = document.getElementById("errorBox");
const retryBtn = document.getElementById("retryBtn");

const statusMessages = [
  "Connecting to backend…",
  "Checking database state…",
  "Loading movie data…",
  "Warming up recommendation engine…",
  "Almost ready…"
];

function updateStatus() {
  const idx = Math.min(attempts, statusMessages.length - 1);
  statusText.textContent = statusMessages[idx];
}

async function checkBackend(){
  attempts++;
  updateStatus();

  try {
    const res = await fetch("http://localhost:8080/api/movies");
    if (res.ok) {
      window.location.href = "index.html";
      return;
    }
  } catch (e) {
    // backend not ready
  }

  if (attempts >= maxAttempts) {
    showError();
    return;
  }

  setTimeout(checkBackend, 1000);
}

function showError(){
  statusText.style.display = "none";
  errorBox.style.display = "block";
  retryBtn.style.display = "inline-block";
}

function retry(){
  attempts = 0;
  errorBox.style.display = "none";
  retryBtn.style.display = "none";
  statusText.style.display = "block";
  statusText.textContent = "Retrying…";
  setTimeout(checkBackend, 1000);
}

checkBackend();


async function checkServer() {
  try {
    const r = await fetch("http://localhost:8080/api/movies");
    if (r.ok) {
      window.location.href = "index.html";
    }
  } catch (e) {
    // still starting
  }
}

setInterval(checkServer, 1500);


</script>

</body>
</html>
